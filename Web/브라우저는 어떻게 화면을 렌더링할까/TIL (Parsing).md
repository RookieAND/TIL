# ✒️ Parsing

### 1. Parsing이란 무엇인가?

-   문서 파싱이란 브라우저가 코드를 이해하고 사용할 수 있는 구조로 변환하는 것을 의미한다.
-   파싱을 통해 변환된 결과는 문서 구조를 나타내는 트리이고, 보통 Parsing Tree, Syntax Tree 라고 한다.

### 2. Parsing 작업은 어떻게 진행되는가?

-   문서 파싱은 브라우저가 문서를 이해하고 사용할 수 있는 구조로 변환하는 과정을 의미한다.
-   HTML 문서의 파싱 결과는 DOM 트리로서, 문서의 구조를 나타내는 노드 트리로 변환된다.

#### 2-1. Parsing의 문법은 어떻게 구성되었나?

-   파싱은 문서에 작성된 언어의 형식 혹은 규칙을 따른다.
-   즉 파싱할 수 있는 모든 형식은 일련의 규칙과 정해진 용어를 따라야 한다.
-   인간의 언어의 경우 정해진 형식과 규칙이 없기에 기계적으로 파싱을 진행할 수 없다.

#### 2-2. 일반적으로 Parsing은 어떻게 진행되는가?

1. 어휘 분석 (Lexical Analyzer, Scanner)

    - 주어진 자료를 유효한 토큰으로 분해하는 과정.
    - 토큰은 유효하게 구성된 단위의 집합체이다.
    - 공백과 줄 바꿈 같은 의미 없는 문자의 경우 제거한다.

2. 구문 분석 (Syntax Analyzer, Parser)

    - 해당 언어의 구문 규칙을 적용하는 과정
    - 어휘 분석을 통해 나온 새 토큰이 구문 규칙과 일치하는지 확인.
    - 규칙에 맞다면 노드가 파싱 트리에 추가되며, 파서는 다음 토큰을 요청함.
    - 규칙에 맞지 않다면 파서는 해당 토큰을 내부적으로 저장하고 다음 토큰을 요청함.
    - 해당 토큰과 일치하는 규칙이 발견되지 않았다면 예외 처리, 구문 오류라는 것을 내포함.

3. 변환

    - 어휘 / 구문 분석을 통해 생성된 파싱 트리는 최종 결과물이 아니다.
    - 소스 코드를 바이트 코드로 만드는 컴파일러의 경우 트리를 기계 코드로 반환한다.

### 3. HTML Parsing이 다른 Parsing과 다른 점.

    - HTML의 경우 일반적인 Parser를 적용할 수 없다.
    - 왜냐면 HTML 언어는 실수에 관대하다. 잘못된 태그 문법을 사용하더라도 오류를 내뿜지 않는다.
    - 설령 인계 받은 HTML 이 잘못 작성되었더라도 브라우저에서는 이를 지적하려 하지 않는다.
    - script 태그 내의 JS 코드 중 `document.write` 와 같은 구문은 새로운 토큰을 추가하기에, 이 과정에서 파싱이 수정될 수 있음.

> document.write 란?

-   HTML 문서 내에 인자로 받은 텍스트를 추가하는 함수다.
-   당연히 텍스트를 작성하기 위해서는 문서가 열려야 하기에, `document.open` 함수가 선행적으로 실행된다.
-   파싱 과정에서 위 함수가 실행될 경우 HTML에 텍스트가 추가되고, 이를 토큰화하여 새로운 토큰이 생성된다.
-   따라서 결과적으로 HTML 문서의 소스와 일치하지 않는 DOM이 생성되어 사용하는 것을 비추천한다.

#### 3-1. HTML에서 사용하는 Parsing 기법은 무엇인가?

1.  Tokenizer (토큰화)

    -   토큰화 (Tokenizer) 는 어휘 분석으로서의 기능을 하며, 입력된 문서를 토큰으로 파싱한다.
    -   HTML 내에서 토큰은 `'시작 태그'`, `'종료 태그'`, `'속성 이름'`, `'속성 값'` 으로 나뉜다.
    -   토큰을 인지했다면 이를 파싱 트리 생성자로 넘기고, 다른 토큰을 확인하기 위해 다음 문자를 체크.

    -   초기 상태는 자료 상태 이며, `<` 문자를 만날 경우 태그 열림 상태로 변환된다.
    -   a-z 까지의 문자를 만날 경우 **시작 태그 토큰**을 생성하고 상태는 태그 이름 상태로 변한다.
    -   하지만 그 전에 `/` 을 만났다면 **종료 태그 토큰**을 생성하고 태그 이름 상태로 변경된다.
    -   `>` 문자를 만나게 될 경우 현재 토큰을 발행하고 상태를 다시 자료 상태로 변경시킨다.

2.  Building DOM Tree (트리 구축)

    -   파서가 생성된다면 처음에는 문서 객체가 생성된다.
    -   이후 트리 구축 진행 시 문서 최상단에 DOM 트리가 수정되며 요소가 추가된다.
    -   토큰화 단계에서 발행된 토큰을 받아 트리 생성자를 통해 각각의 노드를 생성시키는 과정을 거친다.
    -   만약 DOM 트리에 요소를 추가하지 않는다면, 해당 요소는 임시 버퍼 저장소인 스택에 저장된다.
    -   해당 스택의 경우 부정확한 태그들 간의 중첩이나 중료되지 않은 태그들을 교정시킨다.

```html
<html>
    <body>
        Hello world
    </body>
</html>
```
