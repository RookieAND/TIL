# ğŸ“– Introduction

> **react-query** ë¥¼ ì“°ë¼ê³  í•´ì„œ ì“°ê¸´ ì“°ëŠ”ë°.. ì´ê±¸ ì™œ ì¨ì•¼ í•˜ëŠ” ê±¸ê¹Œ?

í•„ìëŠ” í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì„ ê³„ì† ì§„í–‰í•˜ë˜ ë„ì¤‘, ê°œë°œì ì»¤ë®¤ë‹ˆí‹°ì—ì„œ ë¬´í•œ ìŠ¤í¬ë¡¤ êµ¬í˜„ì„ ì‰½ê²Œ í•˜ì‹œë ¤ë©´ `react query` ì™€ Intersection Observerë¥¼ ì˜ ë²„ë¬´ë ¤ì„œ êµ¬í˜„í•˜ë©´ ì¢‹ë‹¤ëŠ” ë§ì„ ë“£ê³  ë¬´ì‘ì • react queryë¥¼ ì‹œì‘í•˜ì˜€ë‹¤.

ë¬¼ë¡  ë¦¬ì•¡íŠ¸ ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•œ ì…ì¥ìœ¼ë¡œì„œ ë§Œì¡±ê°ì€ ìµœìƒì´ì—ˆë‹¤, ê¸°ì¡´ì˜ `useState` ì™€ ì „ì—­ ìƒíƒœê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í™œìš©í•˜ì—¬ ì„œë²„ì—ì„œë¶€í„° ë°ì´í„°ë¥¼ ë°›ì•„ì™€ ì´ë¥¼ ë³´ê´€í•˜ëŠ” ê³¼ì •ì€ ì¢…ì¢… ì˜ˆìƒì¹˜ ëª»í•œ ì—ëŸ¬ë¥¼ ë‚´ë¿œê¸° ë§ˆë ¨ì´ì—ˆê³ , í•´ë‹¹ ì½”ë“œë¥¼ ì¼ê´€ì„± ìˆê²Œ ì‘ì„±í•˜ëŠ” ê²ƒì€ ë”ë”ìš± ì–´ë ¤ì› ë‹¤. í•˜ì§€ë§Œ ë¦¬ì•¡íŠ¸ ì¿¼ë¦¬ëŠ” ì´ëŸ¬í•œ ë‹¨ì ì„ ë§ì´ ìƒì‡„ì‹œì¼œì¤€ ê³ ë§ˆìš´ ì¹œêµ¬ì˜€ë‹¤.

í•˜ì§€ë§Œ ì´ ê³ ë§ˆìš´ ì¹œêµ¬ê°€ ì •í™•íˆ ì–´ë–¤ ì¼ì„ í•˜ëŠ” ê±´ì§€, ê·¸ë¦¬ê³  ë‚˜ëŠ” ì´ê±¸ ì™œ ì¨ì•¼ í•˜ëŠ”ì§€ì— ëŒ€í•œ ì‹¬ë„ ìˆëŠ” ê³ ì°°ì´ í•„ìš”í•œ ì‹œì ì´ ë°”ë¡œ ì§€ê¸ˆì´ë¼ê³  ìƒê°í•˜ì—¬, ë¦¬ì•¡íŠ¸ ì¿¼ë¦¬ê°€ ì–´ì©Œë‹¤ ë§Œë“¤ì–´ì¡Œê³  ì´ê±¸ ì¨ì•¼ í•˜ëŠ” ì´ìœ ì™€, ë¦¬ì•¡íŠ¸ ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•¨ì— ìˆì–´ í•„ìš”í•œ ê¸°ë³¸ ì§€ì‹ì„ ì •ë¦¬í•˜ê³ ì í•œë‹¤.

# âœ’ï¸ Server State

#### Server Stateë€ ë¬´ì—‡ì¸ê°€?

1. state (ìƒíƒœ)

-   Reactì—ì„œëŠ” ë Œë”ë§ì— ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ Object ë¼ê³  ì •ì˜.
-   Global State (ì „ì—­ ìƒíƒœ) ëŠ” ì–´í”Œë¦¬ì¼€ì´ì…˜ ì–´ë””ì—ì„œë“  ì ‘ê·¼ì´ ê°€ëŠ¥í•¨.
-   ë˜í•œ ì „ì—­ ìƒíƒœì˜ ë³€í™”ëŠ” ê³§ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë Œë”ë§ì— ì „ë°˜ì ìœ¼ë¡œ ì˜í–¥ì„ ë¯¸ì¹¨.

2. Client State

-   UI í…Œë§ˆ, ì‚¬ì´ë“œë°”, í¼ ì…ë ¥ ë“±ê³¼ ê°™ì´ **í´ë¼ì´ì–¸íŠ¸ê°€ ì†Œìœ í•˜ê³  ì œì–´í•˜ëŠ”** ë°ì´í„°ë¥¼ ì˜ë¯¸.
-   í´ë¼ì´ì–¸íŠ¸ì—ì„œ í•­ìƒ ì œì–´ê°€ ê°€ëŠ¥í•˜ê¸°ì— í•­ìƒ ë™ê¸°ì ì¸ ìƒíƒœë¥¼ ê°€ì§.
    -   local client state : í¼ ì…ë ¥, ì‚¬ì´ë“œë°” ê°™ì´ í•˜ë‚˜ ë˜ëŠ” ì¸ì ‘í•œ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í•˜ëŠ” state.
    -   global client state : ì–¸ì–´, UI í…Œë§ˆ (ë‹¤í¬ ëª¨ë“œ) ì™€ ê°™ì´ ì–´í”Œë¦¬ì¼€ì´ì…˜ì— ì „ë°˜ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” state.

3. Server State

-   ìœ ì € DB ì •ë³´ ë“±ê³¼ ê°™ì´ í´ë¼ì´ì–¸íŠ¸ê°€ **ì„œë²„ë¡œë¶€í„° ë°›ì•„ì˜¤ëŠ” ëª¨ë“  ë°ì´í„°** ë¥¼ ì˜ë¯¸í•¨.
-   í´ë¼ì´ì–¸íŠ¸ê°€ ì œì–´í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ì—†ê¸°ì— **íŠ¹ì • ì‹œì **ìœ¼ë¡œë¶€í„° ë°›ì•„ì˜¨ ë°ì´í„°ë¥¼ ì‚¬ìš©í•¨. ì´ë¡œ ì¸í•´ ë¹„ë™ê¸°ì ì¸ ìƒíƒœë¥¼ ê°€ì§.
-   ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ ê°„ì˜ stateê°€ í•­ìƒ ì¼ì¹˜í•œë‹¤ëŠ” ë³´ì¥ì´ ì—†ìœ¼ë©°, í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë” ì´ìƒ **ìœ íš¨í•˜ì§€ ì•Šì€ ë°ì´í„°**ë¥¼ ì†Œìœ í•  ê°€ëŠ¥ì„±ì´ ìˆìŒ.

# âœ’ï¸ Why React Query?

### âœï¸ React Query ê°€ ëŒ€ì²´ ë­”ê°€?

> **fetching, caching, synchronizing and updating server state** in your React applications - tanstack

-   react-queryëŠ” ì„œë²„ì—ì„œë¶€í„° ë°ì´í„°ë¥¼ fetchingí•˜ê³ , í´ë¼ì´ì–¸íŠ¸ì™€ ë™ê¸°í™”í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤.
-   ì„œë²„ë¡œë¶€í„° ë°›ì•„ì˜¨ ë°ì´í„°ë¥¼ ë³„ë„ì˜ í‚¤ë¥¼ í†µí•´ ê´€ë¦¬í•˜ê³ , **ìºì‹±**í•˜ëŠ” ì—­í• ë„ í•œë‹¤.
-   ì‚¬ìš©ìì˜ ë¡œì§ì— ë”°ë¼ í•„ìš”í•œ ë°ì´í„°ë¥¼ ì„œë²„ ìª½ì—ì„œ ë°›ì•„ì™€ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì—…ë°ì´íŠ¸ (refetch) í•˜ëŠ” ê¸°ëŠ¥ì„ í•œë‹¤.

### âœï¸ ì´ê±¸ ì™œ ì¨ì•¼ í•˜ëŠ”ê°€?

1. React ì—ì„œëŠ” ë°ì´í„°ë¥¼ fetching í•˜ê±°ë‚˜ update í•˜ëŠ” ë°©ë²•ì„ ì œê³µí•˜ì§€ ì•ŠëŠ”ë‹¤.

-   ë”°ë¼ì„œ ê°œë°œìë“¤ì€ ê°ìì˜ ë°©ì‹ëŒ€ë¡œ ì„œë²„ë¡œë¶€í„° ë°ì´í„°ë¥¼ fetching í•˜ëŠ” ë°©ì‹ì„ ì„¤ê³„í•˜ì˜€ë‹¤.
-   ë³´í†µì€ Custom Hookì„ í™œìš©í•˜ì—¬ stateì— ê°’ì„ ì „ë‹¬í•˜ê±°ë‚˜, Redux ê°™ì€ ì „ì—­ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ì¸ê³„ë°›ì€ ë°ì´í„°ë¥¼ ì €ì¥í•œë‹¤.

2. Client stateì™€ Server stateì˜ **ì™„ì „í•œ ë¶„ë¦¬** ë¥¼ ìœ„í•¨ì´ë‹¤.

-   ì¼ë°˜ì ìœ¼ë¡œ ì„œë²„ì—ì„œ ë°›ì•„ì˜¨ server stateì˜ ê²½ìš° ì „ì—­ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ í•©ë¦¬ì ì´ë‹¤. ì™œëƒí•˜ë©´ stateë¥¼ í•„ìš”ë¡œ í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ì—ì„œ ê°œë³„ì ìœ¼ë¡œ API í˜¸ì¶œì„ í•˜ëŠ” ê²ƒì€ í° ë¹„ìš© ë‚­ë¹„ì´ê¸° ë•Œë¬¸ì´ë‹¤.
-   í•˜ì§€ë§Œ ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ì—ì„œ stateë¥¼ ê³µìœ í•˜ë ¤ props drilling ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒë„ í•œê³„ê°€ ìˆê¸°ì—, ì „ì—­ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ì—ì„œ ì¸ê³„ë°›ì€ server stateë¥¼ ë§ˆì¹˜ cache ì²˜ëŸ¼ ê´€ë¦¬í•œë‹¤ë©´ í›¨ì”¬ ì ‘ê·¼ì´ ìš©ì´í•´ì§„ë‹¤.
-   ê·¸ëŸ¬ë‚˜ Redux ê°™ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•  ê²½ìš° ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ë°›ì•„ì™€ ìƒíƒœ ê´€ë¦¬ë¥¼ í•˜ê¸° ìœ„í•´ ë³„ë„ì˜ ì‘ì—… (Redux-Saga) ì´ í•„ìš”í•˜ê³ , ì´ë¡œ ì¸í•´ ê´€ë ¨ ë¡œì§ ë° ëª¨ë“ˆì´ ë¹„ëŒ€í•´ì§„ë‹¤.
-   react-queryì˜ ê²½ìš° Server Stateì™€ ê´€ë ¨ëœ ì‘ì—…ì„ ì™„ë²½íˆ êµ¬ë¶„ì§€ì–´ ì œê³µí•˜ê¸°ì—, Client State ê¹Œì§€ ë‹´ë‹¹í•˜ëŠ” ì „ì—­ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œë¶€í„° ì´ë¥¼ ë¶„ë¦¬í•´ì¤€ë‹¤.

3. Server State ëŠ” í•­ìƒ ìµœì‹ ì˜ ìƒíƒœì„ì„ ë³´ì¥í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì´ë‹¤.

-   ì „ì—­ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ê²½ìš°, ì„œë²„ì˜ ë°ì´í„°ì™€ ë‹¤ë¥¸ ê°’ì„ ë³´ìœ í•  ìˆ˜ë„ ìˆë‹¤. ê·¸ì— ëŒ€í•œ ì´ìœ ëŠ” ì•ì„œ ë§í•œ server stateì˜ ë¹„ë™ê¸°ì ì¸ íŠ¹ì„± ë•Œë¬¸ì´ë‹¤.
-   ì„œë²„ì—ì„œ ë°›ì•„ì˜¨ ë°ì´í„°ëŠ” ë°ì´í„°ë¥¼ ë¡œë“œí•œ ì‹œê°„ì˜ **"ìŠ¤ëƒ…ìƒ·"** ì— ë¶ˆê³¼í•˜ë‹¤. ë”°ë¼ì„œ ëª…ì‹œì ìœ¼ë¡œ fetchingì„ í•´ì¤˜ì•¼ ìµœì‹ ì˜ ë°ì´í„°ë¡œ ì „í™˜ë˜ëŠ”ë°, ì´ëŸ¬í•œ ì‘ì—…ì„ ì—¬ëŸ¬ë²ˆ ìˆ˜í–‰í•˜ê¸°ì—ëŠ” ë¹„ìš©ì´ í¬ë‹¤.
-   react-queryì˜ ê²½ìš° stateì˜ ìƒíƒœë¥¼ fresh, stale, inactiveë¡œ êµ¬ë¶„ì§€ìœ¼ë©° ìœ íš¨í•˜ì§€ ì•Šì€ ìƒíƒœë¼ë©´ ë°±ê·¸ë¼ìš´ë“œ ë‹¨ìœ„ì—ì„œ ë°ì´í„°ë¥¼ refetching í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.

4. react-queryë¥¼ í†µí•´ Server stateë¥¼ í›¨ì”¬ ì‰½ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.

-   react queryì˜ ê²½ìš° ì•„ë˜ì˜ ê¸°ëŠ¥ì„ ì§€ì›í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë©°, ë¡œì§ ë˜í•œ ë‹¨ìˆœí•œ ì¶•ì— ì†í•œë‹¤.
-   í˜„ì¬ ë°ì´í„°ê°€ fetching ë˜ì—ˆëŠ”ì§€, ì•„ë‹ˆë©´ ì¤‘ê°„ì— ì—ëŸ¬ê°€ ë°œìƒí–ˆëŠ”ì§€ë¥¼ ì‰½ê²Œ ì²´í¬í•  ìˆ˜ ìˆë‹¤.

1. ì„œë²„ë¡œë¶€í„° ë°›ì€ ë°ì´í„°ë¥¼ ìºì‹±
2. ë™ì¼í•œ ë°ì´í„°ì— ëŒ€í•œ ì—¬ëŸ¬ ìš”ì²­ì„ ë‹¨ì¼ ìš”ì²­ìœ¼ë¡œ ë³€í™˜
3. ë°±ê·¸ë¼ìš´ë“œ ë‹¨ì—ì„œ ì˜¤ë˜ëœ ë°ì´í„°ë¥¼ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸
4. ë°ì´í„°ê°€ í˜„ì¬ ì˜¤ë˜ëœ (stale) ìƒíƒœë¡œ ë³€í–ˆëŠ”ì§€ë¥¼ í™•ì¸.
5. ì„œë²„ë¡œë¶€í„° ë°›ì€ ë°ì´í„°ë¥¼ ê´€ë¦¬í•˜ê³ , GCì— ì˜í•´ ì†Œê±°ë˜ëŠ” ê³¼ì •ë„ ê´€ì°°.

# âœ’ï¸ What is Query?

### âœï¸ React Query ì—ì„œ ì¿¼ë¦¬ëŠ” ë¬´ì—‡ì„ ì˜ë¯¸í•˜ëŠ”ê°€?

> A query is a declarative dependency on an asynchronous source of data that is tied to a unique key

-   QueryëŠ” Server stateë¥¼ ìš”ì²­í•˜ëŠ” í•¨ìˆ˜ (QueryFn) ê³¼ í•¨ê»˜ ê³ ìœ í•œ í‚¤ (QueryKey) ë¡œ ë§¤í•‘ëœë‹¤.
-   ì„œë²„ë¡œë¶€í„° ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ê²½ìš°ì—ëŠ” `useQuery`, `useInfiniteQuery` Hookì„ ì“´ë‹¤.
-   ë‹¨, ì„œë²„ì˜ ë°ì´í„°ë¥¼ ìˆ˜ì •í•  ê²½ìš°ì—ëŠ” `useMutation` Hookì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

### âœï¸ queryKeyì™€ queryFnì— ëŒ€í•˜ì—¬.

```javascript
function Todos() {
    const { isLoading, isError, data, error } = useQuery({
        queryKey: ['todos'],
        queryFn: fetchTodoList,
    });

    if (isLoading) {
        // if (state === 'loading')
        return <span>Loading...</span>;
    }

    if (isError) {
        // if (state === 'error')
        return <span>Error: {error.message}</span>;
    }

    // ì´ ì§€ì ê¹Œì§€ ì½”ë“œê°€ ë„ë‹¬í–ˆë‹¤ë©´, ì •ìƒì ìœ¼ë¡œ ì¿¼ë¦¬ê°€ success stateë¥¼ ê°€ì§.
    return (
        <ul>
            {data.map((todo) => (
                <li key={todo.id}>{todo.title}</li>
            ))}
        </ul>
    );
}
```

-   `queryKey` ëŠ” refetch, caching ë“±ê³¼ ê°™ì€ ì‘ì—…ì„ í• ë•Œ ì“°ì´ëŠ” ê³ ìœ í•œ í‚¤ë‹¤. v4 ë¶€í„°ëŠ” ë°°ì—´ë¡œë§Œ keyë¥¼ ì„ ì–¸í•´ì•¼ í•œë‹¤.
-   `queryFn` ì˜ ê²½ìš° ì„œë²„ë¡œë¶€í„° ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ ì“°ì´ëŠ” ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ ì˜ë¯¸í•˜ë©° ë°˜ë“œì‹œ Promiseë¥¼ ë¦¬í„´í•´ì•¼ í•œë‹¤.

### âœï¸ ì¿¼ë¦¬ê°€ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆë‹¤ë©´?

-   ë§Œì•½ ì¿¼ë¦¬ê°€ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆë‹¤ë©´, react queryì˜ ê²½ìš° ê¸°ë³¸ì ìœ¼ë¡œ ì„¸ ì°¨ë¡€ ì¬ìš”ì²­ì„ ì§„í–‰í•œë‹¤.
-   ë§Œì•½ ì¬ìš”ì²­ íšŸìˆ˜ì™€ ì¸í„°ë²Œì„ ìˆ˜ì •í•˜ê³  ì‹¶ë‹¤ë©´, `retry` ì˜µì…˜ê³¼ `retryDelay` ì˜µì…˜ì„ ë³„ë„ë¡œ ì„¤ì •í•˜ì.

### âœï¸ ì¿¼ë¦¬ì˜ ìƒíƒœëŠ” ì–´ë–»ê²Œ êµ¬ë¶„ì§“ëŠ”ê°€?

-   `useQuery` ê°€ ë¦¬í„´í•œ ê²°ê³¼ ê°ì²´ì˜ `state` í”„ë¡œí¼í‹°ë¡œ ì¿¼ë¦¬ì˜ ìƒíƒœë¥¼ íŒŒì•…í•œë‹¤.
-   `state` ì†ì„±ì˜ ê²½ìš° í˜„ì¬ mount ëœ ì¿¼ë¦¬ ì¸ìŠ¤í„´ìŠ¤ì˜ ìƒíƒœë¥¼ íŒŒì•…í•  ë•Œ ì“°ì¸ë‹¤.

1. loading : ì¿¼ë¦¬ê°€ ì•„ì§ **ë°ì´í„°ë¥¼ ê°€ì§€ì§€ ì•ŠìŒ** ì„ ì˜ë¯¸.
2. error : ì¿¼ë¦¬ ì‹¤í–‰ ë„ì¤‘ ì˜ˆìƒì¹˜ ëª»í•œ **ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŒ** ì„ ì˜ë¯¸.
3. success: ì¿¼ë¦¬ê°€ ì„±ê³µì ìœ¼ë¡œ ì‘ë™ë˜ì—ˆìœ¼ë©°, **ë°ì´í„°ê°€ ìœ íš¨í•¨** ì„ ì˜ë¯¸.

-   `fetchState` ì†ì„±ì˜ ê²½ìš° ì¿¼ë¦¬ê°€ ì‚¬ìš©í•œ `queryFn` ì˜ ë™ì‘ ê²°ê³¼ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤.

1. idle: í˜„ì¬ í•´ë‹¹ ì¿¼ë¦¬ì˜ `queryFn` ì´ ë™ì‘í•˜ì§€ ì•Šê³  ìˆìŒì„ ì˜ë¯¸.
2. fetching: í˜„ì¬ ì¿¼ë¦¬ê°€ ì„œë²„ë¡œë¶€í„° ë°ì´í„°ë¥¼ fetching ì¤‘ì„ì„ ì˜ë¯¸.
3. paused: ì¿¼ë¦¬ê°€ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ë˜ ì¤‘ì— ì¤‘ì§€ë˜ì—ˆìŒì„ ì˜ë¯¸. (ë„¤íŠ¸ì›Œí¬ ì´ìŠˆ ë“±)

-   ë”°ë¼ì„œ `state` ì™€ `fetchState` ë¥¼ ëª¨ë‘ í™•ì¸í•˜ì—¬ ì¿¼ë¦¬ì˜ ìƒíƒœë¥¼ ìœ ì¶”í•  ìˆ˜ ìˆë‹¤.

### âœï¸ ì¿¼ë¦¬ê°€ ì°¸ì¡°í•˜ëŠ” ë°ì´í„°ì˜ ìƒíƒœëŠ” ì–´ë–»ê²Œ êµ¬ë¶„í•˜ëŠ”ê°€?

1. fresh
    - í•´ë‹¹ ì¿¼ë¦¬ê°€ ë³´ê´€í•œ ë°ì´í„°ê°€ ì•„ì§ **ìœ íš¨**í•¨ì„ ì˜ë¯¸.
    - ìƒˆë¡œìš´ ì¿¼ë¦¬ ì¸ìŠ¤í„´ìŠ¤ê°€ mount ë˜ì—ˆì„ ë•Œë‚˜, ì°½ì´ í¬ì»¤ì‹± ë˜ì—ˆì„ ë•Œì™€ ê°™ì´ refetchë¥¼ ìœ ë°œí•˜ëŠ” ì´ë²¤íŠ¸ê°€ trigger ë˜ë”ë¼ë„ ì´ë¥¼ ì§„í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤.
2. stale:
    - í•´ë‹¹ ì¿¼ë¦¬ì˜ ìœ íš¨ ê¸°ê°„ì´ ì§€ë‚˜ **ì˜¤ë˜ëœ ë°ì´í„°**ê°€ ë˜ì—ˆìŒì„ ì˜ë¯¸.
    - ê¸°ë³¸ì ìœ¼ë¡œ freshí•œ ë°ì´í„°ëŠ” fetchingì´ ì™„ë£Œë˜ëŠ” ì¦‰ì‹œ staleí•œ ìƒíƒœë¡œ ë³€ê²½ë¨.
    - `staleTime` ì˜µì…˜ì„ í†µí•´ freshí•œ ë°ì´í„°ê°€ stale í•œ ìƒíƒœê°€ ë˜ê¸°ê¹Œì§€ ê±¸ë¦¬ëŠ” ì‹œê°„ì„ ì§€ì •í•  ìˆ˜ ìˆìŒ.
3. inactive
    - í•´ë‹¹ ì¿¼ë¦¬ê°€ `unmount` ë˜ì–´ í˜„ì¬ ë¹„í™œì„±í™” ë˜ì—ˆìŒì„ ì˜ë¯¸.
    - ê¸°ë³¸ì ìœ¼ë¡œ `inactive` í•œ ìƒíƒœê°€ ëœ í›„ 5ë¶„ì´ ì§€ë‚˜ë©´ í•´ë‹¹ ì¿¼ë¦¬ëŠ” ìë™ìœ¼ë¡œ GCì— ìˆ˜ì§‘ë¨.
    - `cacheTime` ì˜µì…˜ì„ í†µí•´ inactive ëœ ì¿¼ë¦¬ ë°ì´í„°ê°€ GCì—ê²Œ ìˆ˜ì§‘ë˜ê¸°ê¹Œì§€ ê±¸ë¦¬ëŠ” ì‹œê°„ì„ ì§€ì •í•  ìˆ˜ ìˆìŒ.

### âœï¸ React-Queryì—ì„œ ìºì‹±ëœ ë°ì´í„°ëŠ” ì–´ë–»ê²Œ ê´€ë¦¬ë˜ëŠ”ê°€?

-   `useQuery` í˜¹ì€ `useInfiniteQuery` ë¡œ ìƒì„±ëœ ì¿¼ë¦¬ ì¸ìŠ¤í„´ìŠ¤ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ìºì‹±ëœ ë°ì´í„°ë¥¼ `stale` ìƒíƒœë¡œ ë‘”ë‹¤.
-   ë‹¨, `staleTime` ì†ì„±ì„ í†µí•´ í•´ë‹¹ ì¿¼ë¦¬ì— ì¢…ì†ëœ ë°ì´í„°ì˜ ìœ íš¨ ì‹œê°„ì„ ì„¤ì •í•  ìˆ˜ ìˆë‹¤. (ë‹¨ìœ„ : ms)

```tsx
const { data, hasNextPage, fetchNextPage } = useInfiniteQuery(
    ['question', { sortOption, answeredOption }],
    ({ pageParam = 1 }) => getQuestionsAsync(pageParam, amount, sortOption, answeredOption),
    {
        getNextPageParam: (lastPage) => {
            if (!lastPage || !lastPage.isSuccess || lastPage.result.isLast) {
                return undefined;
            }
            return lastPage.result.nextPage;
        },
        // staleTimeì€ 5ë¶„ìœ¼ë¡œ ì„¤ì •í•¨.
        staleTime: 30000,
    }
);
```

-   React Query ì—ì„œëŠ” ì•„ë˜ì™€ ê°™ì€ í˜„ìƒì´ ë°œìƒí•  ê²½ìš° `stale` í•œ ì¿¼ë¦¬ë¥¼ ì¦‰ì‹œ refetch í•œë‹¤.
-   í•˜ë‹¨ì˜ ì†ì„±ì€ ëª¨ë‘ QueryClient ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•  ë•Œ `defaultOptions` ì˜µì…˜ìœ¼ë¡œ ì¡°ì •í•  ìˆ˜ ìˆë‹¤.

```tsx
const [queryClient] = useState(
    new QueryClient({
        defaultOptions: {
            queries: {
                refetchOnReconnect: false,
                refetchOnWindowFocus: false,
            },
        },
    })
);
```

    1. ìƒˆë¡œìš´ ì¿¼ë¦¬ ì¸ìŠ¤í„´ìŠ¤ê°€ mount ë˜ì—ˆì„ ê²½ìš°. (refetchOnMount)
    2. ì‚¬ìš©ìê°€ ì°½ì„ í´ë¦­í•˜ì—¬ focus í•˜ì˜€ì„ ê²½ìš°. (refetchOnWindowFocus)
    3. ë„¤íŠ¸ì›Œí¬ê°€ ì¬ì—°ê²° ë˜ì—ˆì„ ê²½ìš°. (refetchOnReconnect)
    4. ì‚¬ìš©ìê°€ íŠ¹ì • ì£¼ê¸°ë§ˆë‹¤ refetchë¥¼ ì§„í–‰í•˜ë„ë¡ í•œ ê²½ìš° (refetchInterval)

-   ë§Œì•½ í•´ë‹¹ ì¿¼ë¦¬ì˜ ìƒíƒœê°€ `inactive` ë¡œ ë³€í™˜ë˜ê³ , ì„¤ì •ëœ `cacheTime` (ê¸°ë³¸ 5ë¶„) ì´ ì§€ë‚¬ë‹¤ë©´ í•´ë‹¹ ì¿¼ë¦¬ëŠ” GCì— ì˜í•´ ì†Œê±°ëœë‹¤.
-   í•´ë‹¹ ì¿¼ë¦¬ê°€ ì´ì „ì— `fresh` ìƒíƒœì¸ì§€ `stale` ìƒíƒœì¸ì§€ëŠ” ì¤‘ìš”í•˜ì§€ ì•Šë‹¤. ì˜¤ì§ `inactive` ëœ ì‹œì ì„ ê¸°ì¤€ìœ¼ë¡œ cacheTimeì„ ì²´í¬í•œë‹¤.
